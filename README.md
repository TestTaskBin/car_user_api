# Тестовое задание "Список автомобилей и список пользователей"

Тестовое задание для Foundarium.

## Поcтановка задачи

Даны два списка. Список автомобилей и список пользователей.
C помощью laravel сделать api для управления списком использования автомобилей пользователями.

 - В один момент времени 1 пользователь может управлять только одним автомобилем.
 - В один момент времени 1 автомобилем может управлять только 1 пользователь.
 - Код разместить на https://github.com/
 - Подготовить документацию в https://editor.swagger.io/
 - Обязательно наличие тестов.

Уточнения заказчика:

 - **Под «апи для управления списком» подразумевается, в том числе администраторское АПИ для добавления / удаления автомобилей и/или редактирование пользователей?**
 - И то и то.

 - **Что значит «управлять»? Как в каршеринге можно забронировать себе автомобиль? Или можно выбрать авто и как-то им управлять как радиоуправляемой машинкой?**
 - Привязать пользователя к авто.

 - **Может быть что при выборе одного и того же пользователя могут быть разные машины?**
 - Нет, один пользователь - 1 машина.

 - **Нужно ли внести эти два списка в базу данных?**
 - Да

 - **Надо оборачивать все в Docker?**
 - Желательно, не обязательно.

 - **Какую архитектуру стоит применить (к примеру DDD) или достаточного простой архитектуры?**
 - Будет плюсом DDD

## Решение
 
Проект реализован на `PHP8` + `Laravel9`, БД - `SQLite`. 
Реализуется только демонстрационное окружение в `docker`, управляемое через `docker-compose`.

В проекте реализована следующие трактовки постановленной задачи:

 - можно назначить пользователю управление автомобилем если этим автомобилем не управляет другой пользователь и если пользователь не управляет другим автомобилем (операция assign);
 - можно прекратить управление автомобилем, что приведёт к освободжению и автомобиля и пользователя (операция release);
 - нельзя назначить управление автомобилем пользователю, который уже управляет другим автомобилем;
 - нельзя назначить управление автомобилем пользователю, если автомобиль уже управляется другим автомобилем;
 - нельзя удалить через CRUD пользователя, который управляет автомобилем;
 - нельзя удалить через CRUD автомобиль, который управляется пользователем;
 
"Пользователь API" и "пользователи машин" реализованы как разные сущности т.к. из постановки задачи не ясно нужна ли авторизация и разграничение прав между пользователями.

Я исхожу из того, что у API будет единственный пользователь ("администратор"), который будет авторизоваться по токену, редактировать данные "машин", "пользователей машин" и определять кто какой машиной "управляет".

Токены для API будут создаваться без дополнительной авторизации т.к. проект демонстрационный.

CRUD-ы "машин" и "пользователей машин" реализованы стандартными средствами `Laravel` (модель Eloquent + ресурсные контроллеры).

Контроль ограничений бизнес-логики возлагается частично на CONSTRAIN-ы БД, а частично на сервис [CarAssignService](app/app/Services/CarAssignService.php)

В проекте написаны только интеграционные тесты, покрывающие API. Тесты деструктивные, исполняются на отдельной копии БД.

Для генерации OpenAPI был использован пакет [vyuldashev/laravel-openapi](https://github.com/vyuldashev/laravel-openapi).

## Запуск проекта в docker

Нужен `docker`, `docker-compose` и `bash`.

Склонируйте проект и запустите скрипт `init_laravel_develop.sh`.
При желании отредактируйте `docker-compose.yml`.

bash```
git clone ... && cd car_user_api
./init_laravel_develop.sh
```

Запустите контейнеры
bash```
docker-compose up -d
```

Главная страница будет доступна по адресу `http://localhost:8080/`.

Документация в формате OpenAPI включена в проект ( [openapi.json](app/openapi.json) ), а также доступна в SwaggerUI по адресу `http://localhost:8080/openapi`. Ключ API смотри на главной странице.

## Запуск проекта без docker

Запуск стандартны для `Laravel`:

bash```
git clone ... && cd car_user_api/app
cp .env.example  .env
composer install
php artisan migrate
php artisan key:generate
php artisan db:seed
```

Работает встроенный сервер:

bash```
php artisan serve
```

Без докера SwaggerUI требуется поднимать отдельно. Документация в формате OpenAPI включена в проект ( [openapi.json](app/openapi.json) ).
